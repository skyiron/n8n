<script setup lang="ts">
export interface MetricsInputProps {
	modelValue: string[];
}
const props = defineProps<MetricsInputProps>();
const emit = defineEmits<{ 'update:modelValue': [value: MetricsInputProps['modelValue']] }>();

function addNewMetric() {
	emit('update:modelValue', [...props.modelValue, '']);
}

function updateMetric(index: number, value: string) {
	const newMetrics = [...props.modelValue];
	newMetrics[index] = value;
	emit('update:modelValue', newMetrics);
}
</script>

<template>
	<div :class="[$style.formGroup, $style.metrics]">
		<n8n-text color="text-dark">{{
			$locale.baseText('workflowEvaluation.edit.metricsTitle')
		}}</n8n-text>
		<hr :class="$style.metricsDivider" />
		<n8n-text size="small" color="text-light">
			{{ $locale.baseText('workflowEvaluation.edit.metricsHelpText') }}
		</n8n-text>
		<n8n-input-label
			:label="$locale.baseText('workflowEvaluation.edit.metricsFields')"
			:bold="false"
			size="small"
			:class="$style.metricField"
		>
			<div :class="$style.metricsContainer">
				<div v-for="(metric, index) in modelValue" :key="index">
					<N8nInput
						:ref="`metric_${index}`"
						:model-value="metric"
						:placeholder="$locale.baseText('workflowEvaluation.edit.metricsPlaceholder')"
						@update:model-value="(value: string) => updateMetric(index, value)"
					/>
				</div>
				<n8n-button
					type="tertiary"
					:label="$locale.baseText('workflowEvaluation.edit.metricsNew')"
					:class="$style.newMetricButton"
					@click="addNewMetric"
				/>
			</div>
		</n8n-input-label>
	</div>
</template>

<style module lang="scss">
.formGroup {
	margin-bottom: var(--spacing-l);

	:global(.n8n-input-label) {
		margin-bottom: var(--spacing-2xs);
	}
}

.metricsContainer {
	display: flex;
	flex-direction: column;
	gap: var(--spacing-xs);
}

.metricField {
	width: 100%;
	margin-top: var(--spacing-xs);
}

.metricsDivider {
	margin-top: var(--spacing-4xs);
	margin-bottom: var(--spacing-3xs);
}

.newMetricButton {
	align-self: flex-start;
	margin-top: var(--spacing-2xs);
	width: 100%;
	background-color: var(--color-sticky-code-background);
	border-color: var(--color-button-secondary-focus-outline);
	color: var(--color-button-secondary-font);
}
</style>
